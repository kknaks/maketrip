<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
          name="viewport">
    <title>간단한 지도 표시하기</title>
    <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=0zojwabqn9&submodules=geocoder"
            type="text/javascript"></script>
</head>
<body>
<div id="map" style="width:80%;height:800px;"></div>

<script>
    // 서버에서 받은 변수 (Thymeleaf 예시)
    const stateName = [[${stateName}]];
    let cityName = [[${cityName}]];
    let regionType = 'area1';

    // cityName이 있으면 regionType과 cityName 설정 변경
    if (cityName !== "") {
        regionType = 'area2';
    } else {
        cityName = stateName;  // cityName이 없을 때 stateName 사용
    }

    // 지도 객체를 전역 변수로 생성
    var map;

    // 주소를 좌표로 변환하고 지도 중심과 줌을 설정하는 함수
    function initializeMap(cityName, regionType) {
        naver.maps.Service.geocode({
            query: cityName
        }, function (status, response) {
            if (status !== naver.maps.Service.Status.OK) {
                alert('Something went wrong!');
                return;
            }

            var result = response.v2, // 검색 결과의 컨테이너
                items = result.addresses; // 검색 결과의 배열

            if (items.length > 0) {
                let mapx = items[0].x;
                let mapy = items[0].y;

                // 지도 초기화가 되지 않은 경우 초기화 진행
                if (!map) {
                    map = new naver.maps.Map('map', {
                        center: new naver.maps.LatLng(mapy, mapx),
                        zoom: getZoomByRegionType(regionType)
                    });
                } else {
                    // 초기화된 지도에서 중심과 줌 레벨만 설정
                    map.setCenter(new naver.maps.LatLng(mapy, mapx));
                    map.setZoom(getZoomByRegionType(regionType));
                }
            } else {
                console.log("No addresses found.");
            }
        });
    }

    // 줌 레벨을 반환하는 함수
    function getZoomByRegionType(regionType) {
        const zoomLevels = {
            'area1': 11,  // 시/도
            'area2': 13,  // 시/군/구
            'area3': 15,  // 읍/면/동
            'area4': 17   // 리
        };
        return zoomLevels[regionType] || 13;
    }

    // 지도 초기화 함수 호출
    initializeMap(cityName, regionType);

</script>
</body>
</html>
