<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">

<head data-th-replace="~{header :: head}"></head>
<header data-th-replace="~{header :: #page-header}"></header>
<link data-th-href="@{/css/review.css}" rel="stylesheet">

<body>
<!--SweetAlert2-->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<!--fontawesome-->
<script src="https://kit.fontawesome.com/ecaa6a7d50.js" crossorigin="anonymous"></script>
<!-- Bootstrap JS ë° ì¢…ì†ì„± -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<!--Naver MAP API-->
<script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=0zojwabqn9&submodules=geocoder"></script>
<script data-th-src="@{/js/mapUtils.js}"></script>
<script data-th-src="@{/js/pageNavigation.js}"></script>

<style>
    .popover img {
        width: 200px !important;
        height: 200px !important;
        object-fit: cover !important;
        margin-top: 5px !important;
    }
</style>

<!-- ê²Œì‹œê¸€ì´ ì—†ëŠ” ê²½ìš° -->
<p data-th-unless="${board}">ì—†ëŠ” ê²Œì‹œê¸€ì…ë‹ˆë‹¤.</p>

<!-- ê²Œì‹œê¸€ì´ ìˆëŠ” ê²½ìš° -->
<div class="container my-5" style="max-width: 1200px; margin: 0 auto;">
    <div class="container text-center my-4">
        <h1 class="custom-title">
            <span class="highlight">ì—¬í–‰í›„ê¸°</span> ê²Œì‹œíŒ
        </h1>
    </div>

    <form id="myForm" data-th-action="@{modify}" method="post" enctype="multipart/form-data">
        <input type="hidden" name="boardNo" data-th-value="${board.boardNo}">
        <div class="mb-3" id="top">
            <h2 class="form-title" style="margin-left: 10px; font-size: 1.8rem; font-weight: bold;" data-th-text="${board.boardTitle}"></h2>
        </div>

        <div data-th-if="${board}" class="border-bottom pb-3 mb-1">
            <div class="d-flex align-items-center mb-3">
                <img data-th-src="@{https://dgg7dnk35523.edge.naverncp.com/HZiW9aEJy7/user/profile/default.png(type=f,w=20,h=20)}"
                     data-th-unless="${board.writer.userPhoto}"
                     src="/images/default.png"
                     class="rounded-circle me-2" style="width: 40px; height: 40px;">
                <img data-th-if="${board.writer.userPhoto}"
                     data-th-src="@{https://dgg7dnk35523.edge.naverncp.com/HZiW9aEJy7/user/profile/} + ${board.writer.userPhoto} + '?type=f&w=100&h=100'"
                     src="/images/default.png"
                     class="rounded-circle me-2" style="width: 40px; height: 40px;">
                <div style="display: flex; flex-direction: column; align-items: flex-start;">
                    <div style="display: flex; align-items: center;">
                        <h5 class="mb-1" data-th-text="${board.writer.userNickname}" style="margin-right: 10px;">ë‹‰ë„¤ì„</h5>
                        <button type="button"
                                id="chatButton"
                                data-th-writer="${board.writer.userNo}"
                                onclick="connectWebSocket()"
                                class="btn btn-outline-secondary btn-sm">1:1 ì±„íŒ…ìš”ì²­</button>
                    </div>
                    <small class="text-muted" style="margin-top: 5px;">
                        ì‘ì„±ì¼: <span data-th-text="${#dates.format(board.boardCreatedDate, 'yyyy.MM.dd HH:mm')}">ë‚ ì§œ</span>
                        â€¢ ì¡°íšŒ: <span data-th-text="${board.boardCount}">ì¡°íšŒìˆ˜</span>
                    </small>
                </div>
                <div class="ms-auto">
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="location.href='list'">ëª©ë¡</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" data-th-if="${isUserAuthorized}" data-th-onclick="document.getElementById('myForm').submit();">ìˆ˜ì •</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" data-th-if="${isUserAuthorized}" data-th-onclick="|deleteBoard(${board.boardNo})|">ì‚­ì œ</button>
                </div>
            </div>

            <!-- ì¢‹ì•„ìš” ë° ì¦ê²¨ì°¾ê¸° ë²„íŠ¼ -->
            <div class="d-flex align-items-center" >
                <button type="button" id="likeButton" class="btn btn-outline-danger btn-sm me-2"
                        data-th-text="${isLiked != null and isLiked ? 'â¤ï¸ ì¢‹ì•„ìš” ì·¨ì†Œ' : 'ğŸ¤ ì¢‹ì•„ìš”'}"
                        data-th-onclick="toggleLike([[${board.boardNo}]])"></button><br>
                <span id="likeCount" class="me-3" data-th-text="${board.boardLike}">0</span>

                <button type="button" id="favorButton" class="btn btn-outline-warning btn-sm me-2"
                        data-th-text="${isFavored != null and isFavored ? 'â­ ì¦ê²¨ì°¾ê¸° ì·¨ì†Œ' : 'âšª ì¦ê²¨ì°¾ê¸°'}"
                        data-th-onclick="toggleFavor([[${board.boardNo}]])"></button>
                <span id="favorCount" class="me-3" data-th-text="${board.boardFavor}">0</span><br>
            </div>
        </div>

        <div class="modal fade" id="checkLoginModal" tabindex="-1" aria-labelledby="checkLoginModalLabel" aria-hidden="true">
            <div class="modal-dialog" style="margin-top: 300px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="checkLoginModalLabel">ì•Œë¦¼</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ ì°½ìœ¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="confirmLoginButton">í™•ì¸</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div class="container" style="max-width: 1200px; margin: 0 auto;">
        <div class="d-flex justify-content-center align-items-start gap-3 my-3">
            <!-- ì§€ë„ ë³´ì—¬ì£¼ê¸° -->
            <div>
                <div id="map" style="width: 550px; height: 400px;"></div>
            </div>

            <!-- ì´ë¯¸ì§€ ë³´ì—¬ì£¼ê¸° -->
            <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                <!-- Indicators -->
                <div class="carousel-indicators">
                    <div th:each="image, iter : ${board.boardImages}">
                        <button type="button" data-bs-target="#carouselExampleIndicators" th:attr="data-bs-slide-to=${iter.index}"
                                th:classappend="${iter.index == 0 ? 'active' : ''}" aria-current="true" aria-label="Slide [[${iter.index + 1}]]"></button>
                    </div>
                </div>

                <!-- Slides -->
                <div class="carousel-inner">
                    <div th:each="image, iter : ${board.boardImages}"
                         th:classappend="${iter.index == 0 ? 'active' : ''}" class="carousel-item">
                        <a th:href="${
                image != null && image.boardimageName != null && image.boardimageName != 'default.png' ?
                    'https://kr.object.ncloudstorage.com/bitcamp-bucket088a/review/' + image.boardimageName
                    :
                    '/images/city/'
                    + (board.trip != null and board.trip.city != null and board.trip.city.state != null ? board.trip.city.state.stateName : 'default')
                    + '/'
                    + (board.trip != null and board.trip.city != null and board.trip.city.state != null ? board.trip.city.state.stateName : 'default')
                    + ' '
                    + (board.trip != null and board.trip.city != null ? board.trip.city.cityName : 'default')
                    + '.jpg'
            }">
                            <img th:src="${
                    image != null && image.boardimageName != null && image.boardimageName != 'default.png' ?
                        'https://dgg7dnk35523.edge.naverncp.com/HZiW9aEJy7/review/' + image.boardimageName + '?type=u&w=600&h=400'
                        :
                        '/images/city/'
                        + (board.trip != null and board.trip.city != null and board.trip.city.state != null ? board.trip.city.state.stateName : 'default')
                        + '/'
                        + (board.trip != null and board.trip.city != null and board.trip.city.state != null ? board.trip.city.state.stateName : 'default')
                        + ' '
                        + (board.trip != null and board.trip.city != null ? board.trip.city.cityName : 'default')
                        + '.jpg'
                }" class="d-block w-100" style="width: 600px; height: 400px;" alt="Slide [[${iter.index + 1}]]">
                        </a>
                    </div>
                </div>

                <!-- Controls -->
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>

    <div>
        <h4 id="trip" class="mb-2" style="margin-left: 10px; font-size: 1.5rem;">ì „ì²´ ê²½ë¡œ</h4>
        <p class="text-muted mb-3" style="margin-left: 10px; font-size: 0.9rem;"
           data-th-text="${board.trip.startDate != null && board.trip.endDate != null ? #dates.format(board.trip.startDate, 'yyyy.MM.dd(E)') + ' ~ ' + #dates.format(board.trip.endDate, 'yyyy.MM.dd(E)') : 'ë‚ ì§œ ì •ë³´ ì—†ìŒ'}">
        </p>
        <h4 class="mb-2" style="margin-left: 10px; font-size: 1.5rem;" data-th-text="${board.trip.tripTitle}">ì—¬í–‰ì œëª©</h4>
        <!--        <p class="text-muted mb-3" style="margin-left: 10px; font-size: 0.9rem;" data-th-text="${board.trip.thema.themaName}">í…Œë§ˆ</p>-->
        <p class="text-muted mb-3" style="margin-left: 10px; font-size: 0.9rem;"
           data-th-text="${board.trip != null && board.trip.thema != null ? board.trip.thema.themaName : 'No Thema'}">í…Œë§ˆëª… ì—†ìŒ</p>

        <div class="container" style="max-width: 1200px; margin: 0 auto;">
            <div data-th-with="totalIndex=${new java.util.concurrent.atomic.AtomicInteger(0)}">
                <div class="col-md-8 mb-3" data-th-each="entry : ${groupedSchedules}">
                    <div class="d-flex justify-content-between align-items-center mb-1" style="width: 300px ">
                        <h5 class="text-start" style="font-size: 1.2rem;" data-th-text="${entry.key} + 'ì¼ì°¨'">ì¼ì°¨</h5>
                        <span class="text-muted" style="font-size: 1rem;" data-th-text="${dayDates[entry.key]}">ë‚ ì§œ</span>
                    </div>
                    <div class="timeline">
                        <div id="review-location" class="timeline-item mb-1" data-th-each="schedule, iter : ${entry.value}" data-th-object="${schedule}">
                            <span class="location-x" data-th-text="*{location.locationX}" style="display: none;"></span>
                            <span class="location-y" data-th-text="*{location.locationY}" style="display: none;"></span>
                            <span class="location-name" data-th-text="*{location.locationName}" style="display: none;"></span>
                            <span class="location-addr" data-th-text="*{location.locationAddr}" style="display: none;"></span>
                            <span class="location-photo" data-th-text="${schedule.location.locationPhoto != null ? schedule.location.locationPhoto : 'https://via.placeholder.com/70x70'}" style="display: none;"></span>

                            <!-- ì¶”ê°€ëœ ë¶€ë¶„: scheduleRouteì™€ Day -->
                            <span class="schedule-route" data-th-text="*{scheduleRoute}" style="display: none;"></span>
                            <span class="schedule-day" data-th-text="*{scheduleDay}" style="display: none;"></span>

                            <!-- ì¹´ë“œì™€ textareaë¥¼ ê°ì‹¸ëŠ” wrapper -->
                            <div class="d-flex gap-3 mx-auto md-5">
                                <!-- ì¹´ë“œ ë¶€ë¶„ -->
                                <div class="flex-shrink-0" style="width: 300px;">
                                    <div class="p-3 border rounded shadow-sm d-flex justify-content-between align-items-center" style="height: 100px;">  <!-- ë†’ì´ ê³ ì • -->
                                        <!-- Badgeì™€ ì§€ì—­ ì´ë¦„ -->
                                        <div class="d-flex flex-shrink-1 me-2 align-items-start" style="min-width: 0;">
                                            <!-- Badge -->
                                            <div class="badge text-white"
                                                 data-th-classappend="'bg-' + ${entry.key % 6 == 1 ? 'primary' : entry.key % 6 == 2 ? 'warning' : entry.key % 6 == 3 ? 'danger' : entry.key % 6 == 4 ? 'info' : entry.key % 6 == 5 ? 'secondary' : 'success'}"
                                                 style="font-size: 1rem; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center;"
                                                 data-th-text="${iter.index}">ì¼ì • ìˆœì„œ</div>
                                            <!-- ì§€ì—­ ì´ë¦„ -->
                                            <div class="ms-2">
                                                <p class="mb-1" style="font-size: 0.9rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 150px; font-weight: bold;" data-th-text="*{location.locationName}">ì§€ì—­</p>
                                                <p class="mb-1 two-line-ellipsis" style="font-size: 0.8rem; max-width: 150px;" data-th-text="*{location.locationAddr}">ì£¼ì†Œ</p>
                                            </div>
                                        </div>


                                        <!-- ì´ë¯¸ì§€ -->
                                        <div>
                                            <img data-th-src="${schedule.location.locationPhoto != null ? schedule.location.locationPhoto : 'https://via.placeholder.com/70x70'}"
                                                 alt="Location Photo" class="img-thumbnail" style="width: 70px; height: 70px; object-fit: cover;">
                                        </div>
                                    </div>
                                </div>

                                <!-- textarea -->
                                <div class="flex-grow-1">  <!-- ë„ˆë¹„ ê³ ì • -->
                                    <!-- ë†’ì´ ê³ ì •, ë†’ì´ 100%, resize ë¹„í™œì„±í™” -->
                                    <textarea readonly class="form-control schedule-note h-100"
                                    style="background-color: #f8f9fa; resize: none; width: 840px"
                                    data-th-text="${#lists.size(board.boardContent.split('&%')) > totalIndex.get() ? board.boardContent.split('&%')[totalIndex.getAndIncrement()] : ''}">
                                    </textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-2">
            <h4>íƒœê·¸</h4>
            <input readonly type="text" class="form-control border-0 p-2" style="font-size: 1rem;" data-th-value="'#'+${board.boardTag}">
        </div>

        <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" data-th-onclick="|location.href='@{list}'|">ëª©ë¡</button>
        </div>


        <br id="comments" >
        <div data-th-replace="~{review/comment}"></div>
    </div>
</div>

<!-- ìƒë‹¨ ì´ë™ ë²„íŠ¼ -->
<!--<button id="scrollTopButton" onclick="scrollToTop()" class="btn btn-secondary btn-sm" style="position: fixed; bottom: 20px; left: 90%; transform: translateX(-50%); visibility: hidden; padding: 7px 10px;">-->
<!--    <i class="bi bi-arrow-up"></i> ìƒë‹¨ìœ¼ë¡œ ì´ë™-->
<!--</button>-->


<!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
<div id="navButtons" class="btn-group-vertical" style="position: fixed; bottom: 20px; right: 130px; z-index: 1000;">
    <button id="scrollTopButton" class="btn btn-secondary btn-sm">
        <i class="bi bi-arrow-up"></i> ìƒë‹¨ìœ¼ë¡œ ì´ë™
    </button>
    <button id="scrollToCommentsButton" class="btn btn-secondary btn-sm mt-2">
        <i class="bi bi-chat-dots"></i> ëŒ“ê¸€ë¡œ ì´ë™
    </button>
    <button id="scrollToTripButton" class="btn btn-secondary btn-sm mt-2">
        <i class="bi bi-map"></i> ì—¬í–‰ìœ¼ë¡œ ì´ë™
    </button>
</div>

<script>
    const slides = document.querySelectorAll('.slide');
    const paginationDots = document.getElementById('pagination-dots');
    let currentSlideIndex = 0;

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë„¤ë¹„ê²Œì´ì…˜ ì  ìƒì„±
    slides.forEach((_, index) => {
        const dot = document.createElement('i');
        dot.classList.add('bi', index === currentSlideIndex ? 'bi-circle-fill' : 'bi-circle', 'mx-1');
        dot.style.cursor = 'pointer';
        dot.onclick = () => showSlides(index);  // í´ë¦­ ì‹œ í•´ë‹¹ ìŠ¬ë¼ì´ë“œë¡œ ì´ë™
        paginationDots.appendChild(dot);
    });

    // ìŠ¬ë¼ì´ë“œë¥¼ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
    function showSlides(index) {
        currentSlideIndex = (index + slides.length) % slides.length;

        // ìŠ¬ë¼ì´ë“œ í‘œì‹œ
        slides.forEach((slide, i) => {
            slide.style.display = (i === currentSlideIndex) ? 'block' : 'none';
        });

        // ë„¤ë¹„ê²Œì´ì…˜ ì  ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
        const dots = document.querySelectorAll('#pagination-dots i');
        dots.forEach((dot, i) => {
            dot.classList.toggle('bi-circle-fill', i === currentSlideIndex);
            dot.classList.toggle('bi-circle', i !== currentSlideIndex);
        });
    }

    // ìŠ¬ë¼ì´ë“œë¥¼ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
    function changeSlide(n) {
        showSlides(currentSlideIndex + n);
    }

    // ì´ˆê¸° ìŠ¬ë¼ì´ë“œ ì„¤ì •
    showSlides(currentSlideIndex);
</script>

<script data-th-inline="javascript">
    <!-- ê²Œì‹œê¸€ì‚­ì œ -->
    function deleteBoard(no) {
        Swal.fire({
            title: 'í•´ë‹¹ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
            text: 'ë‹¤ì‹œ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ì„¸ìš”.',
            icon: 'warning',

            showCancelButton: true, // cancelë²„íŠ¼ ë³´ì´ê¸°. ê¸°ë³¸ì€ ì›ë˜ ì—†ìŒ
            confirmButtonColor: '#3085d6', // confrim ë²„íŠ¼ ìƒ‰ê¹” ì§€ì •
            cancelButtonColor: '#d33', // cancel ë²„íŠ¼ ìƒ‰ê¹” ì§€ì •
            confirmButtonText: 'í™•ì¸', // confirm ë²„íŠ¼ í…ìŠ¤íŠ¸ ì§€ì •
            cancelButtonText: 'ì·¨ì†Œ', // cancel ë²„íŠ¼ í…ìŠ¤íŠ¸ ì§€ì •

            // reverseButtons: true, // ë²„íŠ¼ ìˆœì„œ ê±°ê¾¸ë¡œ

        }).then(result => { // ë§Œì•½ Promiseë¦¬í„´ì„ ë°›ìœ¼ë©´,
            if (result.isConfirmed) { // ë§Œì•½ ëª¨ë‹¬ì°½ì—ì„œ confirm ë²„íŠ¼ì„ ëˆŒë €ë‹¤ë©´

                Swal.fire({
                    title: 'ì‚­ì œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',
                    text: 'í›„ê¸° ì‚­ì œì™„ë£Œ~!',
                    icon: 'success',

                    confirmButtonColor: '#3085d6', // confrim ë²„íŠ¼ ìƒ‰ê¹” ì§€ì •
                    confirmButtonText: 'í™•ì¸', // confirm ë²„íŠ¼ í…ìŠ¤íŠ¸ ì§€ì •
                }).then(result => {
                    location.href = "delete?boardNo=" + no;
                });
            }
        });
    }

    // ì¢‹ì•„ìš” í† ê¸€ í•¨ìˆ˜
    function toggleLike(boardNo) {
        const isLoggedIn = [[${isLoggedIn}]];

        if (!isLoggedIn) {
            const checkLoginModal = new bootstrap.Modal(document.getElementById('checkLoginModal'), {
                backdrop: 'static',
                keyboard: false
            });
            checkLoginModal.show();
        } else {
            fetch(`like/${boardNo}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
            })
            .then(response => {
                return response.json().then(result => ({status: response.ok, data: result}));
            })
            .then(({status, data}) => {
                if (status) {
                    // UI ì—…ë°ì´íŠ¸: ì¢‹ì•„ìš” ë²„íŠ¼ ë° ì¹´ìš´íŠ¸ ë³€ê²½
                    const likeButton = document.getElementById('likeButton');
                    const likeCount = document.getElementById('likeCount');

                    likeButton.textContent = data.isLiked ? 'â¤ï¸ ì¢‹ì•„ìš” ì·¨ì†Œ' : 'ğŸ¤ ì¢‹ì•„ìš”';
                    likeCount.textContent = data.likeCount;

                    // ì„±ê³µ í† ìŠ¤íŠ¸ ë©”ì‹œì§€
                    Swal.fire({
                        toast: true,
                        position: 'top-start',
                        icon: 'success',
                        title: 'ì¢‹ì•„ìš”ê°€ ì¶”ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        showConfirmButton: false,
                        timer: 1500,
                        timerProgressBar: true,
                    });
                } else {
                    // ì˜¤ë¥˜ í† ìŠ¤íŠ¸ ë©”ì‹œì§€
                    Swal.fire({
                        toast: true,
                        position: 'top-start',
                        icon: 'error',
                        title: result.message || 'ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                        showConfirmButton: false,
                        timer: 1500,
                        timerProgressBar: true,
                    });
                }
            })
            .catch(error => {
                console.error('ì¢‹ì•„ìš” ìš”ì²­ ì‹¤íŒ¨:', error);
                // alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
                // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ í† ìŠ¤íŠ¸ ë©”ì‹œì§€
                Swal.fire({
                    toast: true,
                    position: 'top-start',
                    icon: 'error',
                    title: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.',
                    showConfirmButton: false,
                    timer: 1500,
                    timerProgressBar: true,
                });
            });
        }
    }

    // ì¦ê²¨ì°¾ê¸° í† ê¸€ í•¨ìˆ˜
    function toggleFavor(boardNo) {
        const isLoggedIn = [[${isLoggedIn}]];

        if (!isLoggedIn) {
            const checkLoginModal = new bootstrap.Modal(document.getElementById('checkLoginModal'), {
                backdrop: 'static',
                keyboard: false
            });
            checkLoginModal.show();
        } else {
            fetch(`favor/${boardNo}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
            })
            .then(response => {
                return response.json().then(result => ({status: response.ok, data: result}));
            })
            .then(({status, data}) => {
                if (status) {
                    // UI ì—…ë°ì´íŠ¸: ì¢‹ì•„ìš” ë²„íŠ¼ ë° ì¹´ìš´íŠ¸ ë³€ê²½
                    const favorButton = document.getElementById('favorButton');
                    const favorCount = document.getElementById('favorCount');

                    favorButton.textContent = data.isFavored ? 'â­ ì¦ê²¨ì°¾ê¸° ì·¨ì†Œ' : 'âšª ì¦ê²¨ì°¾ê¸°';
                    favorCount.textContent = data.favorCount;

                    // ì„±ê³µ í† ìŠ¤íŠ¸ ë©”ì‹œì§€
                    Swal.fire({
                        toast: true,
                        position: 'top-start',
                        icon: 'success',
                        title: 'ì¦ê²¨ì°¾ê¸° ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        showConfirmButton: false,
                        timer: 1500,
                        timerProgressBar: true,
                    });
                } else {
                    // ì˜¤ë¥˜ í† ìŠ¤íŠ¸ ë©”ì‹œì§€
                    Swal.fire({
                        toast: true,
                        position: 'top-start',
                        icon: 'error',
                        title: data.message || 'ì¦ê²¨ì°¾ê¸° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                        showConfirmButton: false,
                        timer: 1500,
                        timerProgressBar: true,
                    });
                }
            })
            .catch(error => {
                console.error('ì¦ê²¨ì°¾ê¸° ìš”ì²­ ì‹¤íŒ¨:', error);
                // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ í† ìŠ¤íŠ¸ ë©”ì‹œì§€
                Swal.fire({
                    toast: true,
                    position: 'top-start',
                    icon: 'error',
                    title: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.',
                    showConfirmButton: false,
                    timer: 1500,
                    timerProgressBar: true,
                });
            });
        }
    }

    document.addEventListener('DOMContentLoaded', async () => {
        console.log(document.querySelectorAll('#review-location').length);

        const stateName = /*[[${board.trip.city.state.stateName}]]*/ "defaultState";
        const cityName = /*[[${board.trip.city.cityName}]]*/ "defaultCity";

        const colors = ["primary", "warning", "danger", "info", "secondary", "success"];

        try {
            // ì§€ë„ì´ˆê¸°í™”
            await initializeMap("map", stateName, cityName);

            // addMarker(126.545219, 33.524923);
            const locationInfos = document.querySelectorAll('#review-location');
            console.log(locationInfos);

            locationInfos.forEach((locationInfo) => {
                const locationX = locationInfo.querySelector('.location-x')?.textContent?.trim();
                const locationY = locationInfo.querySelector('.location-y')?.textContent?.trim();
                const scheduleRoute = locationInfo.querySelector('.schedule-route')?.textContent?.trim();
                const scheduleDay = locationInfo.querySelector('.schedule-day')?.textContent?.trim();

                const locationName = locationInfo.querySelector('.location-name')?.textContent?.trim();
                const locationAddr = locationInfo.querySelector('.location-addr')?.textContent?.trim();
                const locationPhoto = locationInfo.querySelector('.location-photo')
                    ? locationInfo.querySelector('.location-photo').textContent.trim()
                    : null;

                const color = colors[(scheduleDay - 1) % colors.length];

                // ë””ë²„ê¹…: ê°’ í™•ì¸
                console.log({
                    locationX,
                    locationY,
                    locationName,
                    locationAddr,
                    locationPhoto,
                    scheduleRoute,
                    scheduleDay,
                });

                // x, y ì¢Œí‘œê°€ ì˜ ê°€ì ¸ì™€ì¡ŒëŠ”ì§€ ì¶œë ¥í•©ë‹ˆë‹¤.
                console.log(`Location X: ${locationX}, Location Y: ${locationY}`);

                // ìœ íš¨í•œ x, y ì¢Œí‘œê°€ ìˆëŠ” ê²½ìš° addMarker í•¨ìˆ˜ í˜¸ì¶œ
                if (locationX && locationY) {
                    addMarkerWithPopover(
                        parseFloat(locationX),
                        parseFloat(locationY),
                        parseInt(scheduleRoute),
                        `text-${color}`,
                        locationName,
                        locationAddr,
                        locationPhoto
                    );
                }
            });
        } catch (error) {
            console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
        }
    });
</script>
</body>
</html>
