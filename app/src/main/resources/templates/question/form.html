<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>여행 리뷰 작성</title>
</head>
<body>
<label for="tripSelect">여행 선택:</label>
<select id="tripSelect" onchange="loadScheduleList(this.value)">
    <option value="">여행을 선택하세요</option>
    <option th:each="trip : ${trips}"
            th:text="${trip.tripTitle}"
            th:value="${trip.tripNo}">gdag
    </option>
</select>

<table border="1">
    <thead>
    <tr>
        <th>여행번호</th>
        <th>여행제목</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="trip : ${trips}">
        <td><span th:text="${trip.tripNo}">22</span></td>
        <td><span th:text="${trip.tripTitle}">gdag</span></td>
    </tr>
    </tbody>
</table>

<!-- Schedule 리스트 -->
<div id="scheduleContainer" style="display: none;">
    <h2>일정 리스트</h2>
    <table border="1">
        <thead>
        <tr>
            <th>일정번호</th>
            <th>장소</th>
            <th>일차</th>
            <th>순서</th>
        </tr>
        </thead>
        <tbody id="scheduleTableBody">
        </tbody>
    </table>
</div>

<form method="post" th:action="@{/question/add}">
    <input id="selectedTripNo" name="tripNo" type="hidden">
    <div>
        <label for="boardTitle">제목:</label>
        <input id="boardTitle" name="boardTitle" placeholder="제목을 입력해 주세요." type="text">
    </div>
    <div>
        <label for="boardContent">내용:</label>
        <textarea cols="100" id="boardContent" name="boardContent" placeholder="내용을 입력해 주세요."
                  rows="10"></textarea>
    </div>
    <div>
        <label for="boardTag">태그:</label>
        <input id="boardTag" name="boardTag" placeholder="#태그를 입력해 주세요." type="text">
    </div>
    <div>
        <input type="submit" value="등록">
        <button th:onclick="|location.href='@{/question/list}'|" type="button">취소</button>
    </div>
</form>

<!-- JavaScript -->
<script th:inline="javascript">
    /*<![CDATA[*/
    function loadScheduleList(tripNo) {
        // hidden input에 선택된 tripNo 값을 설정
        document.getElementById('selectedTripNo').value = tripNo;

        if (tripNo) {
            fetch(`/question/getScheduleList?tripNo=${tripNo}`)
                .then(response => response.json())
                .then(data => {
                    const scheduleContainer = document.getElementById('scheduleContainer');
                    const scheduleTableBody = document.getElementById('scheduleTableBody');
                    scheduleTableBody.innerHTML = ''; // 기존 데이터를 초기화합니다.

                    if (data.length > 0) {
                        data.forEach(schedule => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${schedule.scheduleNo}</td>
                                <td>${schedule.location ? schedule.location.locationName : 'N/A'}</td>
                                <td>${schedule.scheduleDay}</td>
                                <td>${schedule.scheduleRoute}</td>
                            `;
                            scheduleTableBody.appendChild(row);
                        });
                        scheduleContainer.style.display = 'block';
                    } else {
                        scheduleTableBody.innerHTML = '<tr><td colspan="4">일정 데이터가 없습니다.</td></tr>';
                        scheduleContainer.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error fetching schedule:', error);
                    scheduleContainer.style.display = 'none';
                });
        } else {
            document.getElementById('scheduleContainer').style.display = 'none';
        }
    }

    /*]]>*/
</script>
</body>
</html>
